<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8"/>
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1, user-scalable=0"/>
		<link media="all" type="text/css" rel="stylesheet" href="css/game.css">
		<script src = "scripts/jQuery.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/2.3.0/socket.io.js"></script>
		<script type = "text/javascript" src = "scripts/socket.js"></script>
		<script type = "text/javascript" src = "localStorage/script.js"></script>
	</head>

	<body>


		<script>

		  var userFirstname, userLastname, userEmail, userId, userProfile;  

		  function getUserData(response){

				FB.api('/me', 'GET', {fields: 'first_name, last_name, email, id'}, function(response) {

                    userFirstname = response.first_name;
                    userLastname = response.last_name;
                    userEmail = response.email;
                    userId = response.id;
                    userProfile = 'https://graph.facebook.com/'+userId+'/picture?type=large';
 
                    socket.emit("sendDataToServer",  {firstName: userFirstname, lastName: userLastname, email: userEmail, imageUrl: userProfile});

                });

                startGame();

		  }

		  window.fbAsyncInit = function() {
		    FB.init({
		      appId      : '806502046431924',
		      cookie     : true,
		      xfbml      : true,
		      version    : 'v4.0'
		    });
		      
		    FB.AppEvents.logPageView();   

		    FB.getLoginStatus(function(response) {   // Called after the JS SDK has been initialized.

		    	//checks if the user is connected on FB
		    	if (response.status === 'connected') {
					
					// //getUserData(response);
					FB.logout(function(response) {
					  // user is now logged out
					  console.log("user force log out");
					});

					//startGame();

				} else {
					console.log("user already log out");
				}
		      	
		    });     
		  };

		  (function(d, s, id){
		     var js, fjs = d.getElementsByTagName(s)[0];
		     if (d.getElementById(id)) {return;}
		     js = d.createElement(s); js.id = id;
		     js.src = "https://connect.facebook.net/en_US/sdk.js";
		     fjs.parentNode.insertBefore(js, fjs);
		   }(document, 'script', 'facebook-jssdk'));


		  function showFBLoginDialog(){

		  	//log in the user to FB, shows FB log in dialog
		  	FB.login(function(response) {

		  		//check if the user authenticate data access to the server
		  		if(response.authResponse){

		  			getUserData(response);
		  		}
		  		else{
		  			console.log("user did not log in");
		  		}

		  	}, { scope: 'email' });
		  }

		  function startGame(){
		  	$("#fbButton").addClass("hide");
            $("#startButton").removeClass("hide");
		  }

		</script>

		<div id="fb-root"></div>
		<script async defer crossorigin="anonymous" src="https://connect.facebook.net/en_US/sdk.js#xfbml=1&version=v4.0&appId=806502046431924&autoLogAppEvents=1"></script>

		<!--div id="unLocatedUser"><div class = "mainText"></div></div-->

		<div id = "gameContainer">

			<div id = "gameScreen">
				<div class = "mainText"><img src="images/title.png"/></div>
				<div class = "mainText"></div>
			</div>

			<div class = "displayTitle">
				<span>Bot</span>
				<img src="images/title.png"/>
				<span>Player</span>
			</div>

			<canvas id="gameScene"></canvas>

			<div class = "displayData">

				<div class = "displayData-blocks">
					<div>
						<div>Time: <span class = "timeCD">0</span></div>
					</div>
				</div>

				<div id = "userBlock" class = "displayData-blocks">
					<div id = "userImage"></div>
				</div>

				<div class = "displayData-blocks">
					<div>
						<div>Score: <span class = "playerScore">0</span></div>
					</div>
				</div>

			</div>
			
		</div>
		<canvas id="userInterface" class="controller"></canvas>

		

		<div id = "nonGameComponent">

			<div id = "loader"><div class ="loaderImage"></div></div>

			<div id = "panel">

				<div id = "introduction">
					<div class ="upperSection"><div class ="mainText">Welcome to Pick & Play</div></div>
					<div class ="lowerSection">
						<div class="action-blocks">

							<!-- <fb:login-button id = "fbButton" scope="public_profile,email" onlogin="showFBLoginDialog();" class="fb-login-button" data-width="" data-size="medium" data-button-type="continue_with" data-auto-logout-link="false" data-use-continue-as="false"></fb:login-button> -->

							<div id = "fbButton" class = "buttons" onclick="showFBLoginDialog()">Log in with Facebook</div>

							<div id = "startButton" class = "buttons hide">Start</div>
						</div>
						<div class="action-blocks">
							<a href = ""  id = "agreementText">By logging in you accept the terms and conditions</a>
						</div>
					</div>
				</div>

				<div id = "win" class = "hide">

					<div class = "displayTitle"><img src ="images/title.png"/></div>

					<div><div class ="mainText">Congratulations, You win!</div></div>
					<div><div id="foodPhoto"></div><div id="qrCode"></div></div>
					<div>
						<div><a id = "downloadButton" download = "QR.jpg" onclick="downloadQR(this);">Download QR code</a></div>
						<div><div id = "continueButton">Play Again</div></div>
					</div>

				</div>

				<div id = "playAgain" class = "hide">

					<div class = "displayTitle"><img src ="images/title.png"/></div>
					<div>
						<div class ="mainText">Nice Game</div>
					</div>
					<div>
						<div id ="playAgainButton">Play Again</div>
					</div>
				</div>

				<div class="que-notif" style="display: none;">
					<div class="notification-text mainText"></div>	
				</div>
				
			</div>

		</div>

		<!-- <script type = "text/javascript" src = "socket.io/dist/socket.io.js"></script> -->
		
		<script src = "scripts/easeljs.min.js"></script>
		<script src = "scripts/preloadJS.js"></script>
		<script src = "scripts/game.js"></script>

		<script> 

			$(window).resize(function(){

				var getParentHeight = $(".displayData > div:nth-child(2)").height();

		        $("#userImage").width(getParentHeight+"px");
		        $("#userImage").height(getParentHeight+"px");
			});

		</script>
		
	</body>

</html>